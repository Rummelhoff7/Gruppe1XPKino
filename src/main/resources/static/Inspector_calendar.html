<!DOCTYPE html>
<html lang="da">
<head>
    <meta charset="UTF-8">
    <title>Kalender</title>
    <link rel="stylesheet" href="/css/clean.css">
</head>
<body>
<header class="page-header">
    <h1>Choose date for sold tickets overview</h1>
</header>


<div class="calendar">
    <div class="calendar-header">
        <button id="prevMonth" class="btn btn-orange">&lt;</button>
        <h2 id="monthYear"></h2>
        <button id="nextMonth" class="btn btn-orange">&gt;</button>
    </div>
    <div class="calendar-grid" id="calendar-grid"></div>
</div>
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const calendarGrid = document.getElementById('calendar-grid');
        const monthYear = document.getElementById('monthYear');
        const prevBtn = document.getElementById('prevMonth');
        const nextBtn = document.getElementById('nextMonth');

        let currentDate = new Date();

        function renderCalendar(date) {
            calendarGrid.innerHTML = "";

            const year = date.getFullYear();
            const month = date.getMonth(); // 0 = januar
            const firstDay = new Date(year, month, 1).getDay(); // 0 = søndag
            const daysInMonth = new Date(year, month + 1, 0).getDate();

            const monthNames = [
                "Januar", "Februar", "Marts", "April", "Maj", "Juni",
                "Juli", "August", "September", "Oktober", "November", "December"
            ];
            monthYear.textContent = `${monthNames[month]} ${year}`;

            const startDay = (firstDay + 6) % 7; // Mandag = 0

            // Tilføj tomme felter
            for (let i = 0; i < startDay; i++) {
                const empty = document.createElement('div');
                empty.classList.add('day', 'empty');
                calendarGrid.appendChild(empty);
            }

            // Tilføj dagene
            for (let d = 1; d <= daysInMonth; d++) {
                const day = document.createElement('div');
                day.classList.add('day');
                day.textContent = d;

                day.onclick = () => {
                    const clickedDate = new Date(year, month, d);
                    const isoDate = clickedDate.toISOString();

                    fetch("/api/gem-dato", {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({ showingTime: isoDate })
                    })
                        .then(response => {
                            if (!response.ok) throw new Error("Fejl ved gemning");
                            return response.text();
                        })
                        .then(() => {
                            window.location.href = "Inspector_sold_tickets.html?dato=" + encodeURIComponent(isoDate);
                        })
                        .catch(err => {
                            alert("Noget gik galt: " + err.message);
                        });
                };

                calendarGrid.appendChild(day);
            }
        }

        // Navigation
        prevBtn.onclick = () => {
            currentDate.setMonth(currentDate.getMonth() - 1);
            renderCalendar(currentDate);
        };
        nextBtn.onclick = () => {
            currentDate.setMonth(currentDate.getMonth() + 1);
            renderCalendar(currentDate);
        };

        renderCalendar(currentDate);
    });
</script>


</body>
</html>
